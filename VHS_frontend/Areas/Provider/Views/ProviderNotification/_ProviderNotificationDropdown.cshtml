@model List<VHS_frontend.Areas.Provider.Models.Notification.ProviderNotificationDTO>
@{
    // Helper function to convert NotificationType to Vietnamese
    string GetNotificationTypeVN(string type)
    {
        return type switch
        {
            "Payment" => "Thanh toán",
            "Booking" => "Đặt lịch",
            "System" => "Hệ thống",
            "Promotion" => "Khuyến mãi",
            "Confirmed" => "Xác nhận",
            "Canceled" => "Bị hủy",
            "ServiceCompleted" => "Xác nhận hoàn thành",
            "Completed" => "Hoàn thành",
            "Đơn hàng mới" => "Đơn hàng mới",
            "Thanh toán thành công" => "Thanh toán thành công",
            _ => type
        };
    }
}

@if (Model == null || !Model.Any())
{
    <li class="notification-empty">
        <div class="empty-dropdown">
            <i class="bi bi-bell-slash"></i>
            <p>Không có thông báo nào</p>
            <small>Bạn đã đọc tất cả thông báo</small>
        </div>
    </li>
}
else
{
    @foreach (var notification in Model)
    {
        <li class="notification-item @(notification.IsRead == true ? "read" : "unread")" data-notification-id="@notification.NotificationId">
            <a href="#" class="notification-link" onclick="markProviderRead('@notification.NotificationId'); return false;">
                @if (notification.IsRead != true)
                {
                    <span class="notification-dot"></span>
                }
                <div class="notification-content-wrapper">
                    <div class="notification-header">
                        @if (!string.IsNullOrEmpty(notification.NotificationType))
                        {
                            <span class="notification-badge badge-@(notification.NotificationType.ToLower())">@GetNotificationTypeVN(notification.NotificationType)</span>
                        }
                        <span class="notification-time">
                            <i class="bi bi-clock"></i>
                            @{
                                var timeAgo = "";
                                if (notification.CreatedAt.HasValue)
                                {
                                    var diff = DateTime.Now - notification.CreatedAt.Value;
                                    if (diff.TotalMinutes < 1) timeAgo = "Vừa xong";
                                    else if (diff.TotalMinutes < 60) timeAgo = $"{(int)diff.TotalMinutes} phút trước";
                                    else if (diff.TotalHours < 24) timeAgo = $"{(int)diff.TotalHours} giờ trước";
                                    else if (diff.TotalDays < 7) timeAgo = $"{(int)diff.TotalDays} ngày trước";
                                    else timeAgo = notification.CreatedAt.Value.ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    timeAgo = "N/A";
                                }
                            }
                            @timeAgo
                        </span>
                    </div>
                    <div class="notification-text">@notification.Content</div>
                </div>
                <button class="notification-delete-btn" 
                        title="Xóa" 
                        onclick="deleteProviderNotification('@notification.NotificationId'); event.stopPropagation(); return false;">
                    <i class="bi bi-x-lg"></i>
                </button>
            </a>
        </li>
    }
    
    <li class="notification-footer">
        <div class="footer-actions">
            <a href="#" class="footer-btn mark-all-read" onclick="markProviderAllRead(); return false;">
                <i class="bi bi-check-all"></i>
                <span>Đánh dấu tất cả đã đọc</span>
            </a>
            <a href="/Provider/ProviderNotification/Index" class="footer-btn view-all">
                <i class="bi bi-inbox-fill"></i>
                <span>Xem tất cả</span>
            </a>
        </div>
    </li>
}

