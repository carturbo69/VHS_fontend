@model VHS_frontend.Areas.Provider.Models.Profile.ProviderProfileUpdateDTO
@{
    ViewData["Title"] = "Chỉnh sửa Profile";
    Layout = "~/Areas/Provider/Views/_ProviderLayout.cshtml";
}

<div class="provider-profile">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 col-xl-8">
                <div class="edit-form">
                    <div class="profile-header">
                        <h3 class="card-title">
                            <i class="bi bi-pencil-square me-2"></i>
                            Chỉnh sửa Profile Provider
                        </h3>
                    </div>
                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            @TempData["Error"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <form asp-action="Edit" method="post" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="ProviderName" class="form-label">Tên nhà cung cấp <span class="text-danger">*</span></label>
                                    <input asp-for="ProviderName" class="form-control" />
                                    <span asp-validation-for="ProviderName" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="PhoneNumber" class="form-label">Số điện thoại <span class="text-danger">*</span></label>
                                    <input asp-for="PhoneNumber" class="form-control" />
                                    <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="mb-3">
                                    <label asp-for="Description" class="form-label">Mô tả</label>
                                    <textarea asp-for="Description" class="form-control" rows="4"></textarea>
                                    <span asp-validation-for="Description" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="mb-3">
                                    <label asp-for="ImageFile" class="form-label">Hình ảnh</label>
                                    <input asp-for="ImageFile" class="form-control" type="file" accept="image/*" />
                                    <span asp-validation-for="ImageFile" class="text-danger"></span>
                                    <div class="form-text">Chọn file hình ảnh từ máy tính (JPG, PNG, GIF - tối đa 5MB)</div>
                                    
                                    <!-- Hidden field để lưu URL hình ảnh hiện tại -->
                                    <input asp-for="Images" type="hidden" />
                                    
                                    <!-- Hiển thị hình ảnh hiện tại nếu có -->
                                    @if (!string.IsNullOrEmpty(Model.Images))
                                    {
                                        <div class="mt-2">
                                            <label class="form-label"><strong>Hình ảnh hiện tại:</strong></label>
                                            <div>
                                                <img src="@Model.Images" alt="Current Image" class="img-thumbnail" style="max-width: 200px; max-height: 200px;" />
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 text-center">
                                <button type="submit" class="btn btn-primary me-3">
                                    <i class="bi bi-check-circle me-2"></i> 
                                    Cập nhật Profile
                                </button>
                                <a href="@Url.Action("Index", "ProviderProfile")" class="btn btn-secondary">
                                    <i class="bi bi-arrow-left me-2"></i> 
                                    Quay lại
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // File upload preview
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.querySelector('input[type="file"]');
            const imagePreview = document.querySelector('.image-preview');
            
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Kiểm tra loại file
                        if (!file.type.startsWith('image/')) {
                            alert('Vui lòng chọn file hình ảnh');
                            fileInput.value = '';
                            return;
                        }
                        
                        // Kiểm tra kích thước file (5MB)
                        if (file.size > 5 * 1024 * 1024) {
                            alert('File không được vượt quá 5MB');
                            fileInput.value = '';
                            return;
                        }
                        
                        // Hiển thị preview
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            if (!imagePreview) {
                                // Tạo div preview nếu chưa có
                                const previewDiv = document.createElement('div');
                                previewDiv.className = 'image-preview';
                                previewDiv.innerHTML = '<img src="' + e.target.result + '" alt="Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px;" />';
                                fileInput.parentNode.appendChild(previewDiv);
                            } else {
                                imagePreview.innerHTML = '<img src="' + e.target.result + '" alt="Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px;" />';
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        });
    </script>
}
