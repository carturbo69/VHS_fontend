@{
    ViewData["Title"] = "Thanh to√°n th√†nh c√¥ng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var transactionId = ViewBag.TransactionId as string;
    var bookingIds = ViewBag.BookingIds as List<Guid>;
    var needLogin = ViewBag.NeedLogin as bool? ?? false;
    var total = ViewBag.Total as decimal? ?? 0;
    
    // L·∫•y th·ªùi gian hi·ªán t·∫°i theo timezone Vi·ªát Nam (UTC+7)
    var vietnamTimeZone = TimeZoneInfo.FindSystemTimeZoneById("SE Asia Standard Time");
    var currentTime = TimeZoneInfo.ConvertTimeFromUtc(DateTime.UtcNow, vietnamTimeZone);
}

@section Styles {
    <link rel="stylesheet" href="~/css/payment-success.css" asp-append-version="true" />
}

<div class="payment-success-wrapper">
    <div class="payment-success-card">
        <div class="success-icon-wrapper">
            <div class="success-icon">
                <svg viewBox="0 0 52 52">
                    <path d="M14 27l9 9 19-19" />
                </svg>
            </div>
        </div>

        <h1>üéâ Thanh to√°n th√†nh c√¥ng!</h1>
        <p>C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª• c·ªßa ch√∫ng t√¥i. Giao d·ªãch c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng.</p>

        <div class="transaction-info">
            <div class="transaction-info-item">
                <label>Ph∆∞∆°ng th·ª©c thanh to√°n</label>
                <span>VNPay</span>
            </div>
            @if (!string.IsNullOrEmpty(transactionId))
            {
                <div class="transaction-info-item">
                    <label>M√£ giao d·ªãch</label>
                    <span>@transactionId</span>
                </div>
            }
            @if (bookingIds != null && bookingIds.Any())
            {
                <div class="transaction-info-item">
                    <label>S·ªë l∆∞·ª£ng d·ªãch v·ª•</label>
                    <span>@bookingIds.Count booking</span>
                </div>
            }
            @if (total > 0)
            {
                <div class="transaction-info-item highlight">
                    <label>T·ªïng thanh to√°n</label>
                    <span>@total.ToString("N0")‚Ç´</span>
                </div>
            }
            <div class="transaction-info-item">
                <label>Th·ªùi gian</label>
                <span>@currentTime.ToString("dd/MM/yyyy HH:mm:ss")</span>
            </div>
        </div>

        @if (bookingIds != null && bookingIds.Any())
        {
            var serviceNamesMap = ViewBag.ServiceNames as Dictionary<Guid, string> ?? new Dictionary<Guid, string>();
            <div class="booking-list">
                <div class="booking-list-title">D·ªãch v·ª• ƒë√£ ƒë·∫∑t th√†nh c√¥ng:</div>
                @for (int i = 0; i < bookingIds.Count; i++)
                {
                    var bookingId = bookingIds[i];
                    var serviceName = serviceNamesMap.TryGetValue(bookingId, out var name) ? name : $"D·ªãch v·ª• s·ªë {i + 1}";
                    <div class="booking-item">
                        <div class="booking-number">
                            <span class="number-badge">@(i + 1)</span>
                            <span class="booking-label">@serviceName</span>
                        </div>
                        <span class="badge">‚úì ƒê√£ thanh to√°n</span>
                    </div>
                }
            </div>
        }

        @if (needLogin)
        {
            <div class="warning-box">
                <p><strong>‚ö†Ô∏è L∆∞u √Ω:</strong> Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem chi ti·∫øt ƒë∆°n h√†ng v√† theo d√µi tr·∫°ng th√°i d·ªãch v·ª•.</p>
            </div>

            <div class="btn-group">
                <a href="@Url.Action("Login", "Account", new { area = "", returnUrl = Url.Action("ConfirmVnPayAfterLogin", "Payment", new { area = "Customer", bookingIds = string.Join(",", bookingIds ?? new List<Guid>()), transactionId }) })" 
                   class="btn-primary-success">
                    üîê ƒêƒÉng nh·∫≠p ngay
                </a>
                <a href="@Url.Action("Index", "Home", new { area = "" })" class="btn-secondary-success">
                    üè† V·ªÅ trang ch·ªß
                </a>
            </div>
        }
        else
        {
            <div class="btn-group">
                <a href="@Url.Action("ListHistoryBooking", "BookingService", new { area = "Customer" })" 
                   class="btn-primary-success">
                    üìã Xem l·ªãch s·ª≠ booking
                </a>
                <a href="@Url.Action("Index", "Home", new { area = "" })" class="btn-secondary-success">
                    üè† V·ªÅ trang ch·ªß
                </a>
            </div>
        }

        <div class="footer-note">
            N·∫øu c√≥ b·∫•t k·ª≥ th·∫Øc m·∫Øc n√†o, vui l√≤ng li√™n h·ªá v·ªõi ch√∫ng t√¥i qua <strong>hotline</strong> ho·∫∑c <strong>email h·ªó tr·ª£</strong>.
        </div>
    </div>
</div>

