@model VHS_frontend.Areas.Customer.Controllers.PaymentController.PaymentSuccessViewModel
@using System.Globalization
@{
    ViewData["Title"] = "Thanh toán thành công";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var vi = CultureInfo.GetCultureInfo("vi-VN");
    
    // Lấy thời gian hiện tại theo timezone Việt Nam (UTC+7)
    var vietnamTimeZone = TimeZoneInfo.FindSystemTimeZoneById("SE Asia Standard Time");
    var currentTime = TimeZoneInfo.ConvertTimeFromUtc(DateTime.UtcNow, vietnamTimeZone);
}

@section Styles {
    <link rel="stylesheet" href="~/css/payment-success.css" asp-append-version="true" />
}

<div class="payment-success-wrapper">
    <div class="payment-success-card">
        <div class="success-icon-wrapper">
            <div class="success-icon">
                <svg viewBox="0 0 52 52">
                    <path d="M14 27l9 9 19-19" />
                </svg>
            </div>
        </div>

        <h1>🎉 Thanh toán thành công!</h1>
        <p>Cảm ơn bạn! Giao dịch qua <strong>@(string.IsNullOrWhiteSpace(Model.Gateway) ? "cổng thanh toán" : Model.Gateway)</strong> đã được ghi nhận thành công.</p>

        <div class="transaction-info">
            <div class="transaction-info-item">
                <label>Phương thức thanh toán</label>
                <span>@(string.IsNullOrWhiteSpace(Model.Gateway) ? "COD" : Model.Gateway)</span>
            </div>
            @if (Model.BookingIds != null && Model.BookingIds.Any())
            {
                <div class="transaction-info-item">
                    <label>Số lượng dịch vụ</label>
                    <span>@Model.BookingIds.Count booking</span>
                </div>
            }
            <div class="transaction-info-item highlight">
                <label>Tổng thanh toán</label>
                <span>@Model.Total.ToString("N0")₫</span>
            </div>
            <div class="transaction-info-item">
                <label>Thời gian</label>
                <span>@currentTime.ToString("dd/MM/yyyy HH:mm:ss")</span>
            </div>
        </div>

        @if (Model.BookingIds != null && Model.BookingIds.Any())
        {
            <div class="booking-list">
                <div class="booking-list-title">Dịch vụ đã đặt thành công:</div>
                @for (int i = 0; i < Model.BookingIds.Count; i++)
                {
                    var bookingId = Model.BookingIds[i];
                    var serviceName = Model.ServiceNames.TryGetValue(bookingId, out var name) ? name : $"Dịch vụ số {i + 1}";
                    <div class="booking-item">
                        <div class="booking-number">
                            <span class="number-badge">@(i + 1)</span>
                            <span class="booking-label">@serviceName</span>
                        </div>
                        <span class="badge">✓ Đã thanh toán</span>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="warning-box">
                <p><strong>ℹ️ Lưu ý:</strong> Không tìm thấy danh sách booking. Nếu bạn vừa thanh toán, vui lòng kiểm tra trong "Lịch sử booking".</p>
            </div>
        }

        @if (!string.IsNullOrWhiteSpace(Model.Note))
        {
            <div class="warning-box">
                <p>@Model.Note</p>
            </div>
        }

        <div class="btn-group">
            <a asp-area="Customer" asp-controller="BookingService" asp-action="ListHistoryBooking" class="btn-primary-success">
                📋 Xem lịch sử booking
            </a>
            <a asp-area="" asp-controller="Home" asp-action="Index" class="btn-secondary-success">
                🏠 Về trang chủ
            </a>
        </div>

        <div class="footer-note">
            Nếu có bất kỳ thắc mắc nào, vui lòng liên hệ với chúng tôi qua <strong>hotline</strong> hoặc <strong>email hỗ trợ</strong>.
            <br>Mã tham chiếu: <strong>@DateTime.Now.Ticks</strong>
        </div>
    </div>
</div>
