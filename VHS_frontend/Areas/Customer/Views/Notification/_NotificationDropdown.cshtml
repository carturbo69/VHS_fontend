@model VHS_frontend.Areas.Customer.Models.Notification.NotificationListResponse
@{
    // Helper function to convert NotificationType to Vietnamese
    string GetNotificationTypeVN(string type)
    {
        return type switch
        {
            "PAYMENT_SUCCESS" => "Thanh toán thành công",
            "NEW_BOOKING" => "Đơn hàng mới",
            "BOOKING_CONFIRMED" => "Xác nhận đơn hàng",
            "BOOKING_CANCELLED" => "Hủy đơn hàng",
            "BOOKING_COMPLETED" => "Hoàn thành đơn hàng",
            "Payment" => "Thanh toán",
            "Booking" => "Đặt lịch",
            "System" => "Hệ thống",
            _ => type
        };
    }
    
    // Database đã lưu theo giờ Việt Nam, không cần convert nữa
    DateTime ToVietnamTime(DateTime vietnamTime)
    {
        return vietnamTime;
    }
}

<div class="notification-dropdown" id="notificationDropdown">
    <div class="dropdown-header">
        <h3>Thông báo</h3>
        @if (Model.Data.Any())
        {
            <button type="button" class="btn-mark-all" id="markAllReadDropdown">
                Đánh dấu tất cả đã đọc
            </button>
        }
    </div>

    <div class="dropdown-content">
        @if (Model.Data.Any())
        {
            <div class="notification-items">
                @foreach (var notification in Model.Data.Take(5))
                {
                    <div class="notification-item @(notification.IsRead ? "read" : "unread")" 
                         data-notification-id="@notification.NotificationId"
                         style="cursor: pointer;"
                         @if (!notification.IsRead) { <text>onclick="markAsReadFromDropdown('@notification.NotificationId')"</text> }
                         @if (notification.IsRead) { <text>onclick="window.location.href='/Customer/Notification/Index'"</text> }>
                        
                        <div class="item-icon">
                            @switch (notification.NotificationType.ToLower())
                            {
                                case "booking":
                                case "new_booking":
                                case "booking_confirmed":
                                case "booking_cancelled":
                                case "booking_completed":
                                    <i class="icon-calendar"></i>
                                    break;
                                case "payment":
                                case "payment_success":
                                    <i class="icon-credit-card"></i>
                                    break;
                                case "system":
                                    <i class="icon-settings"></i>
                                    break;
                                default:
                                    <i class="icon-bell"></i>
                                    break;
                            }
                        </div>
                        
                        <div class="item-content">
                            <div class="content-text">@notification.Content</div>
                            <div class="item-time">@ToVietnamTime(notification.CreatedAt).ToString("dd/MM/yyyy HH:mm")</div>
                        </div>
                        
                        @if (!notification.IsRead)
                        {
                            <div class="unread-dot"></div>
                        }
                    </div>
                }
            </div>

            @if (Model.Data.Count > 5)
            {
                <div class="dropdown-footer">
                    <a asp-area="Customer" asp-controller="Notification" asp-action="Index" class="view-all-link">
                        Xem tất cả (@Model.Data.Count)
                    </a>
                </div>
            }
            else if (Model.Data.Count > 0)
            {
                <div class="dropdown-footer">
                    <a asp-area="Customer" asp-controller="Notification" asp-action="Index" class="view-all-link">
                        Xem tất cả
                    </a>
                </div>
            }
        }
        else
        {
            <div class="empty-dropdown">
                <div class="empty-icon">
                    <i class="icon-bell-off"></i>
                </div>
                <p>Không có thông báo mới</p>
            </div>
        }
    </div>
</div>
