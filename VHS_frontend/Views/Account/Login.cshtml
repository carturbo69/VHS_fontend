@model VHS_frontend.Models.Account.LoginDTO
@{
    ViewData["Title"] = "Đăng nhập";
    Layout = "~/Views/Shared/_AuthLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/auth-polish.css" />
}

<section class="auth-wrap">
    <div class="container-xl">
        <div class="auth-grid">
            <!-- ============ PANEL TRÁI (NỘI DUNG MỚI) ============ -->
            <aside class="auth-side auth-side-login" aria-hidden="true">
                <div class="auth-side-inner">
                    <img src="~/images/vhs_logo.png" alt="VHS Logo" class="auth-logo" />

                    <h2 class="auth-heading">
                         Trải nghiệm dịch vụ<br>
                         <span class="auth-heading-accent text-primary">nhanh & tiện lợi</span>
                    </h2>
                    <p class="auth-sub">
                         Chỉ với vài thao tác đơn giản, bạn có thể đặt dịch vụ tại nhà, theo dõi tiến độ 
                         công việc và quản lý mọi thông tin một cách dễ dàng, tiện lợi.
                    </p>

                    <ul class="auth-usp">
                         <li>Đặt lịch trong vài giây – không cần gọi điện hay chờ đợi</li>
                         <li>Cập nhật trạng thái dịch vụ theo thời gian thực, mọi lúc mọi nơi</li>
                         <li>Nhận ưu đãi độc quyền dành riêng cho thành viên thân thiết</li>
                         <li>Hỗ trợ nhanh chóng 24/7 từ đội ngũ chăm sóc khách hàng chuyên nghiệp</li>
                    </ul>

                    <p class="auth-sub" style="margin-top: 24px;">
                        Đăng nhập ngay để tận hưởng cuộc sống <strong>nhàn hơn – an tâm hơn</strong> cùng VHS!
                         Hàng nghìn khách hàng đã tin tưởng và hài lòng với dịch vụ của chúng tôi.
                    </p>
                </div>
            </aside>

            <!-- ============ PANEL PHẢI (FORM) ============ -->
            <div class="auth-card" role="form">
                <h1 class="auth-title">Đăng nhập</h1>
                <p class="auth-desc">
                    Chưa có tài khoản?
                    <a asp-controller="Account" asp-action="Register" class="link">Đăng ký</a>
                </p>

                @if (Context.Request.Query["activated"] == "true")
                {
                    <div id="activationSuccessAlert" class="alert alert-success" role="alert" style="margin-bottom: 20px; padding: 16px; border-radius: 8px; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border: 1.5px solid #28a745; color: #155724; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.15);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <svg style="width: 20px; height: 20px; fill: white;" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                            <div style="flex: 1;">
                                <strong style="font-size: 16px; display: block; margin-bottom: 4px;">Thành công!</strong>
                                <span style="font-size: 14px;">Tài khoản đã được kích hoạt thành công! Bạn có thể đăng nhập ngay.</span>
                            </div>
                        </div>
                    </div>
                }

                @if (TempData["Success"] != null)
                {
                    <div id="resetPasswordSuccessAlert" class="alert alert-success" role="alert" style="margin-bottom: 20px; padding: 16px; border-radius: 8px; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border: 1.5px solid #28a745; color: #155724; box-shadow: 0 4px 12px rgba(40, 167, 69, 0.15);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <svg style="width: 20px; height: 20px; fill: white;" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                            <div style="flex: 1;">
                                <strong style="font-size: 16px; display: block; margin-bottom: 4px;">Thành công!</strong>
                                <span style="font-size: 14px;">@TempData["Success"]</span>
                            </div>
                        </div>
                    </div>
                }

                <form asp-controller="Account" asp-action="Login" method="post" class="form" novalidate>
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="returnUrl" value="@ViewBag.ReturnUrl" />

                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <div class="field">
                        <label class="label" for="Username">Tên đăng nhập hoặc Email</label>
                        <input asp-for="Username" class="input" placeholder="Nhập tên đăng nhập hoặc email"
                               id="Username" autocomplete="username" aria-describedby="uHelp" />
                        <small id="uHelp" class="hint">Bạn có thể sử dụng tên đăng nhập hoặc địa chỉ email của mình</small>
                        <span asp-validation-for="Username" class="text-danger"></span>
                    </div>

                    <div class="field">
                        <label class="label" for="Password">Mật khẩu</label>
                        <div class="input-pass">
                            <input asp-for="Password" class="input" type="password" id="Password"
                                   placeholder="Nhập mật khẩu của bạn" autocomplete="current-password" />
                            <button type="button" class="pass-toggle" aria-label="Hiện/ẩn mật khẩu"
                                    onclick="togglePass('Password', this)" data-icon="eye">
                                <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                        </div>
                        <span asp-validation-for="Password" class="text-danger"></span>
                    </div>

                    <div class="form-row">
                        <!-- <label class="check">
                            <input type="checkbox" name="remember" />
                            <span>Ghi nhớ đăng nhập</span>
                        </label> -->
                        <a asp-controller="Account" asp-action="ForgotPassword" class="link">Quên mật khẩu?</a>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-full btn-glow">Đăng nhập</button>

                    <div class="or"><span>hoặc</span></div>

                    <div class="socials">
                        <div id="g_id_onload"
                            data-client_id="1011562344003-vjmoi74tpfbsetd8vo68202vm9l8rkrd.apps.googleusercontent.com"
                            data-callback="handleGoogleResponse" data-auto_prompt="false" data-ux_mode="popup">
                        </div>

                        <div style="display: flex; justify-content: center;">
                            <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                                data-text="continue_with" data-shape="rectangular" data-logo_alignment="left">
                            </div>
                        </div>
                    </div>
                </form>

                <p class="terms">
                    Khi tiếp tục, bạn đồng ý với
                    <button type="button" id="btnTermsLogin" class="link link-btn">Điều khoản</button>
                    &
                    <button type="button" id="btnPrivacyLogin" class="link link-btn">Chính sách bảo mật</button>.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Modals for Login page -->
<div id="termsModal" class="modal-overlay" hidden>
    <div class="modal-card" role="dialog" aria-modal="true">
        <div class="modal-head">
            <h3 class="modal-title">Chính sách và Điều khoản chung</h3>
            <button type="button" class="btn-close" aria-label="Đóng" onclick="closeModal('termsModal')">×</button>
        </div>
        <div class="modal-body">
            <h6>1. Giới thiệu</h6>
            <p>Chào mừng bạn đến với <strong>Viet Home Service (VHS)</strong> - Nền tảng kết nối dịch vụ gia đình uy tín và chuyên nghiệp. Bằng việc đăng ký và sử dụng tài khoản, bạn đồng ý tuân thủ đầy đủ các điều khoản và điều kiện được nêu trong tài liệu này. Vui lòng đọc kỹ trước khi tiếp tục.</p>
            
            <h6>2. Quyền và Nghĩa vụ của Người dùng</h6>
            <p>Khi sử dụng dịch vụ VHS, bạn có quyền và nghĩa vụ sau:</p>
            <ul>
                <li><strong>Cung cấp thông tin chính xác:</strong> Bạn cam kết cung cấp thông tin cá nhân chính xác, đầy đủ và cập nhật. Thông tin sai lệch có thể dẫn đến việc tạm ngưng hoặc chấm dứt tài khoản.</li>
                <li><strong>Bảo mật tài khoản:</strong> Bạn chịu trách nhiệm bảo mật thông tin đăng nhập, mật khẩu và mọi hoạt động diễn ra trên tài khoản của mình.</li>
                <li><strong>Tuân thủ pháp luật:</strong> Không sử dụng dịch vụ cho mục đích bất hợp pháp, không lạm dụng hệ thống, không vi phạm quyền sở hữu trí tuệ hoặc quyền riêng tư của người khác.</li>
                <li><strong>Sử dụng hợp lý:</strong> Không thực hiện các hành vi gây cản trở, phá hoại hoặc làm gián đoạn hoạt động của hệ thống.</li>
            </ul>
            
            <h6>3. Chính sách Hủy và Hoàn tiền</h6>
            <p>Chúng tôi cam kết minh bạch về chính sách hủy và hoàn tiền:</p>
            <ul>
                <li><strong>Hủy dịch vụ:</strong> Bạn có thể hủy đơn đặt dịch vụ trước khi nhà cung cấp bắt đầu thực hiện. Phí hủy (nếu có) sẽ được thông báo rõ ràng tại thời điểm đặt dịch vụ.</li>
                <li><strong>Hoàn tiền:</strong> Hoàn tiền 100% nếu hủy trong vòng 24 giờ sau khi đặt dịch vụ. Sau 24 giờ, hoàn tiền theo chính sách cụ thể của từng loại dịch vụ.</li>
                <li><strong>Trường hợp đặc biệt:</strong> Trong trường hợp dịch vụ không được thực hiện đúng cam kết, VHS sẽ hỗ trợ giải quyết và hoàn tiền phù hợp.</li>
            </ul>
            
            <h6>4. Phí dịch vụ và Thanh toán</h6>
            <ul>
                <li><strong>Minh bạch về giá:</strong> Tất cả các khoản phí dịch vụ, phí xử lý (nếu có) sẽ được hiển thị rõ ràng trước khi bạn xác nhận thanh toán.</li>
                <li><strong>Phương thức thanh toán:</strong> Chấp nhận thanh toán qua thẻ ngân hàng, ví điện tử, hoặc các phương thức khác được hỗ trợ trên nền tảng.</li>
                <li><strong>Bảo mật thanh toán:</strong> Tất cả giao dịch thanh toán được xử lý qua các cổng thanh toán bảo mật, tuân thủ các tiêu chuẩn quốc tế về bảo mật.</li>
            </ul>
            
            <h6>5. Chấm dứt tài khoản</h6>
            <p>VHS bảo lưu quyền tạm ngưng hoặc chấm dứt tài khoản của bạn trong các trường hợp sau:</p>
            <ul>
                <li>Vi phạm các điều khoản sử dụng hoặc có hành vi gian lận.</li>
                <li>Không cung cấp thông tin chính xác hoặc cố ý cung cấp thông tin sai lệch.</li>
                <li>Lạm dụng hệ thống, spam, hoặc gây ảnh hưởng đến trải nghiệm người dùng khác.</li>
                <li>Vi phạm pháp luật Việt Nam hoặc quy định của nền tảng.</li>
            </ul>
            
            <h6>6. Thay đổi Điều khoản</h6>
            <p>VHS có quyền cập nhật, thay đổi các điều khoản này khi cần thiết. Khi có thay đổi quan trọng, chúng tôi sẽ thông báo đến bạn qua email hoặc thông báo trên nền tảng <strong>tối thiểu 7 ngày</strong> trước khi thay đổi có hiệu lực. Việc tiếp tục sử dụng dịch vụ sau khi thay đổi có hiệu lực được xem là bạn đồng ý với các điều khoản mới.</p>
            
            <h6>7. Liên hệ và Giải quyết Tranh chấp</h6>
            <p>Nếu bạn có bất kỳ câu hỏi hoặc khiếu nại nào về các điều khoản này, vui lòng liên hệ với đội ngũ hỗ trợ của VHS qua email hoặc hotline. Mọi tranh chấp sẽ được giải quyết thông qua thương lượng, hòa giải. Nếu không thể giải quyết, sẽ được đưa ra Tòa án có thẩm quyền tại Việt Nam.</p>
        </div>
        <div class="modal-foot">
            <button type="button" class="btn" onclick="closeModal('termsModal')">Đã hiểu</button>
        </div>
    </div>
</div>

<div id="privacyModal" class="modal-overlay" hidden>
    <div class="modal-card" role="dialog" aria-modal="true">
        <div class="modal-head">
            <h3 class="modal-title">Chính sách bảo mật thông tin</h3>
            <button type="button" class="btn-close" aria-label="Đóng" onclick="closeModal('privacyModal')">×</button>
        </div>
        <div class="modal-body">
            <h6>1. Thu thập thông tin</h6>
            <p>VHS thu thập các loại thông tin sau để cung cấp và cải thiện dịch vụ:</p>
            <ul>
                <li><strong>Thông tin cá nhân:</strong> Họ tên, email, số điện thoại, địa chỉ, ngày sinh (nếu có).</li>
                <li><strong>Thông tin đăng nhập:</strong> Tên đăng nhập, mật khẩu (được mã hóa), và thông tin xác thực khác.</li>
                <li><strong>Thông tin giao dịch:</strong> Lịch sử đặt dịch vụ, thanh toán, đánh giá và phản hồi.</li>
                <li><strong>Thông tin kỹ thuật:</strong> Địa chỉ IP, loại trình duyệt, thiết bị sử dụng, và dữ liệu sử dụng nền tảng (cookies, logs).</li>
            </ul>
            
            <h6>2. Mục đích sử dụng thông tin</h6>
            <p>Chúng tôi sử dụng thông tin của bạn cho các mục đích:</p>
            <ul>
                <li>Cung cấp, duy trì và cải thiện dịch vụ VHS.</li>
                <li>Xử lý giao dịch, thanh toán và quản lý tài khoản của bạn.</li>
                <li>Gửi thông báo quan trọng về dịch vụ, cập nhật điều khoản, hoặc thay đổi chính sách.</li>
                <li>Cá nhân hóa trải nghiệm, gợi ý dịch vụ phù hợp với nhu cầu của bạn.</li>
                <li>Phòng chống gian lận, đảm bảo an ninh và an toàn của nền tảng.</li>
                <li>Tuân thủ các yêu cầu pháp lý và quy định hiện hành.</li>
            </ul>
            
            <h6>3. Lưu trữ và bảo vệ thông tin</h6>
            <p>Chúng tôi cam kết bảo vệ thông tin của bạn bằng các biện pháp:</p>
            <ul>
                <li><strong>Mã hóa dữ liệu:</strong> Sử dụng mã hóa SSL/TLS khi truyền dữ liệu và mã hóa dữ liệu nhạy cảm khi lưu trữ.</li>
                <li><strong>Kiểm soát truy cập:</strong> Chỉ nhân viên được ủy quyền mới có quyền truy cập thông tin, với quy trình xác thực nghiêm ngặt.</li>
                <li><strong>Bảo mật hạ tầng:</strong> Hệ thống được bảo vệ bởi tường lửa, hệ thống phát hiện xâm nhập, và các biện pháp bảo mật tiên tiến.</li>
                <li><strong>Giám sát và kiểm tra:</strong> Thường xuyên kiểm tra, cập nhật hệ thống bảo mật và ứng phó nhanh chóng với các mối đe dọa.</li>
                <li><strong>Thời gian lưu trữ:</strong> Thông tin được lưu trữ trong thời gian cần thiết để cung cấp dịch vụ hoặc theo yêu cầu pháp luật.</li>
            </ul>
            
            <h6>4. Chia sẻ thông tin với bên thứ ba</h6>
            <p>VHS chỉ chia sẻ thông tin của bạn trong các trường hợp sau:</p>
            <ul>
                <li><strong>Nhà cung cấp dịch vụ:</strong> Chia sẻ thông tin cần thiết (tên, số điện thoại, địa chỉ) với nhà cung cấp dịch vụ để họ có thể thực hiện công việc.</li>
                <li><strong>Đối tác thanh toán:</strong> Chia sẻ thông tin thanh toán với các đối tác xử lý thanh toán được ủy quyền, tuân thủ tiêu chuẩn PCI-DSS.</li>
                <li><strong>Yêu cầu pháp luật:</strong> Tiết lộ thông tin khi được yêu cầu bởi cơ quan nhà nước có thẩm quyền hoặc theo quy định pháp luật.</li>
                <li><strong>Bảo vệ quyền lợi:</strong> Chia sẻ khi cần thiết để bảo vệ quyền, tài sản hoặc an toàn của VHS, người dùng hoặc người khác.</li>
            </ul>
            <p><strong>Lưu ý:</strong> Chúng tôi không bán, cho thuê hoặc chia sẻ thông tin cá nhân của bạn cho bên thứ ba vì mục đích marketing mà không có sự đồng ý của bạn.</p>
            
            <h6>5. Quyền của bạn</h6>
            <p>Theo quy định pháp luật về bảo vệ dữ liệu cá nhân, bạn có các quyền sau:</p>
            <ul>
                <li><strong>Quyền truy cập:</strong> Yêu cầu xem thông tin cá nhân mà chúng tôi đang lưu trữ về bạn.</li>
                <li><strong>Quyền chỉnh sửa:</strong> Yêu cầu sửa đổi thông tin cá nhân không chính xác hoặc không đầy đủ.</li>
                <li><strong>Quyền xóa:</strong> Yêu cầu xóa thông tin cá nhân của bạn (trừ trường hợp pháp luật yêu cầu lưu trữ).</li>
                <li><strong>Quyền rút lại đồng ý:</strong> Rút lại sự đồng ý xử lý dữ liệu cá nhân bất cứ lúc nào.</li>
                <li><strong>Quyền phản đối:</strong> Phản đối việc xử lý dữ liệu cá nhân của bạn cho mục đích marketing.</li>
                <li><strong>Quyền khiếu nại:</strong> Khiếu nại với cơ quan có thẩm quyền nếu bạn cho rằng việc xử lý dữ liệu của bạn vi phạm quy định.</li>
            </ul>
            <p>Để thực hiện các quyền trên, vui lòng liên hệ với đội ngũ hỗ trợ của VHS qua email hoặc hotline.</p>
            
            <h6>6. Cookies và Công nghệ theo dõi</h6>
            <p>VHS sử dụng cookies và công nghệ tương tự để:</p>
            <ul>
                <li>Ghi nhớ tùy chọn của bạn và cải thiện trải nghiệm sử dụng.</li>
                <li>Phân tích cách bạn sử dụng nền tảng để tối ưu hóa dịch vụ.</li>
                <li>Cung cấp quảng cáo phù hợp (nếu có).</li>
            </ul>
            <p>Bạn có thể quản lý hoặc xóa cookies thông qua cài đặt trình duyệt của mình. Tuy nhiên, việc tắt cookies có thể ảnh hưởng đến một số chức năng của nền tảng.</p>
            
            <h6>7. Liên hệ về Bảo mật</h6>
            <p>Nếu bạn có bất kỳ câu hỏi, lo ngại hoặc yêu cầu nào liên quan đến chính sách bảo mật này hoặc cách chúng tôi xử lý thông tin cá nhân của bạn, vui lòng liên hệ:</p>
            <ul>
                <li><strong>Email:</strong> support@vhs.vn</li>
                <li><strong>Hotline:</strong> 1900-xxxx (thời gian hỗ trợ: 8:00 - 22:00 hàng ngày)</li>
            </ul>
            <p>Chúng tôi cam kết phản hồi mọi yêu cầu của bạn trong vòng <strong>7 ngày làm việc</strong>.</p>
            
            <p><em><strong>Cập nhật lần cuối:</strong> Chính sách này có thể được cập nhật định kỳ. Phiên bản mới nhất luôn được hiển thị trên nền tảng với ngày cập nhật rõ ràng.</em></p>
        </div>
        <div class="modal-foot">
            <button type="button" class="btn" onclick="closeModal('privacyModal')">Đã hiểu</button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Smooth page transition khi chuyển trang
        (function() {
            // Thêm fade out khi click vào link đăng ký/đăng nhập
            const authLinks = document.querySelectorAll('.link[href*="Register"], .link[href*="Login"]');
            authLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href && !href.startsWith('#')) {
                        e.preventDefault();
                        const authWrap = document.querySelector('.auth-wrap');
                        if (authWrap) {
                            authWrap.style.opacity = '0';
                            authWrap.style.transform = 'translateY(-10px)';
                            authWrap.style.transition = 'opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1), transform 0.25s cubic-bezier(0.4, 0, 0.2, 1)';
                            
                            setTimeout(() => {
                                window.location.href = href;
                            }, 220);
                        } else {
                            window.location.href = href;
                        }
                    }
                });
            });
        })();

        (function () {
          const u = document.getElementById('Username') || document.querySelector('input[name="Username"]');
          if (u) { try { u.focus(); } catch(_){} }

          const sum = document.querySelector('.validation-summary-errors');
          if (sum) {
            document.querySelector('.auth-card')?.classList.add('has-error');
            setTimeout(()=>document.querySelector('.auth-card')?.classList.remove('has-error'), 380);
          }

          // Auto-hide success alerts after 5 seconds
          const activationAlert = document.getElementById('activationSuccessAlert');
          const resetPasswordAlert = document.getElementById('resetPasswordSuccessAlert');
          
          if (activationAlert) {
            setTimeout(() => {
              activationAlert.style.transition = 'opacity 0.5s ease-out';
              activationAlert.style.opacity = '0';
              setTimeout(() => activationAlert.remove(), 500);
            }, 5000);
          }
          
          if (resetPasswordAlert) {
            setTimeout(() => {
              resetPasswordAlert.style.transition = 'opacity 0.5s ease-out';
              resetPasswordAlert.style.opacity = '0';
              setTimeout(() => resetPasswordAlert.remove(), 500);
            }, 5000);
          }
        })();

        function togglePass(id, btn) {
          const input = document.getElementById(id);
          if (!input) return;
          const willShow = input.type === "password";
          input.type = willShow ? "text" : "password";
          btn.classList.toggle("on", willShow);
          const svg = btn.querySelector('svg');
          if (!svg) return;
          if (willShow) {
             svg.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>';
          } else {
             svg.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
          }
        }

        // Modal helpers for Login page
        function openModal(id){
          const el = document.getElementById(id);
          if (!el) return;
          el.removeAttribute('hidden');
          el.classList.add('show');
          document.body.style.overflow = 'hidden';
          el.addEventListener('click', function onBg(e){ if (e.target === el) { el.removeEventListener('click', onBg); closeModal(id); } });
          el._escHandler = function(e){ if (e.key === 'Escape') { closeModal(id); } };
          document.addEventListener('keydown', el._escHandler);
        }
        function closeModal(id){
          const el = document.getElementById(id);
          if (!el) return;
          el.classList.remove('show');
          document.body.style.overflow = '';
          setTimeout(()=>{ try { el.setAttribute('hidden',''); } catch(_){} }, 180);
          if (el._escHandler) { document.removeEventListener('keydown', el._escHandler); el._escHandler = null; }
        }

        // Wire login links
        document.addEventListener('DOMContentLoaded', function(){
          document.getElementById('btnTermsLogin')?.addEventListener('click', function(e){ e.preventDefault(); openModal('termsModal'); });
          document.getElementById('btnPrivacyLogin')?.addEventListener('click', function(e){ e.preventDefault(); openModal('privacyModal'); });
          
          // Tự động ẩn thông báo kích hoạt thành công sau 3 giây
          const activationAlert = document.getElementById('activationSuccessAlert');
          if (activationAlert) {
            setTimeout(() => {
              activationAlert.style.opacity = '0';
              setTimeout(() => {
                activationAlert.style.display = 'none';
              }, 300); // Đợi animation fade out hoàn tất
            }, 3000); // Hiển thị 3 giây rồi ẩn
          }
        });
    </script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script>
        function handleGoogleResponse(response) {
            console.log("Google token:", response.credential);
            fetch('/Account/GoogleLogin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ idToken: response.credential })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) window.location.href = data.redirectUrl;
                    else alert(data.message || "Đăng nhập Google thất bại");
                })
                .catch(err => {
                    console.error(err);
                    alert("Có lỗi khi đăng nhập Google");
                });
        }
    </script>
}
